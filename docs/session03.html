<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Session 3 Large-dimensional methods for forecasting | Financial Econometrics - Tutorials</title>
  <meta name="description" content="TA materials for the Financial Econometrics course held by Prof. Christian Brownlees at the Barcelona School of Economics." />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Session 3 Large-dimensional methods for forecasting | Financial Econometrics - Tutorials" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="TA materials for the Financial Econometrics course held by Prof. Christian Brownlees at the Barcelona School of Economics." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Session 3 Large-dimensional methods for forecasting | Financial Econometrics - Tutorials" />
  
  <meta name="twitter:description" content="TA materials for the Financial Econometrics course held by Prof. Christian Brownlees at the Barcelona School of Economics." />
  

<meta name="author" content="Alessandro Ciancetta" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="session02.html"/>
<link rel="next" href="session04.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Financial Econometrics at BSE</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="1" data-path="session01.html"><a href="session01.html"><i class="fa fa-check"></i><b>1</b> Introduction to time series</a>
<ul>
<li class="chapter" data-level="1.1" data-path="session01.html"><a href="session01.html#stochastic-processes-and-dependence"><i class="fa fa-check"></i><b>1.1</b> Stochastic processes and dependence</a>
<ul>
<li class="chapter" data-level="" data-path="session01.html"><a href="session01.html#stationarity"><i class="fa fa-check"></i>Stationarity</a></li>
<li class="chapter" data-level="" data-path="session01.html"><a href="session01.html#ergodicity"><i class="fa fa-check"></i>Ergodicity</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="session01.html"><a href="session01.html#asymptotic-results"><i class="fa fa-check"></i><b>1.2</b> Asymptotic results</a></li>
<li class="chapter" data-level="1.3" data-path="session01.html"><a href="session01.html#empirical-moments-and-summary-statistics"><i class="fa fa-check"></i><b>1.3</b> Empirical moments and summary statistics</a></li>
<li class="chapter" data-level="1.4" data-path="session01.html"><a href="session01.html#hypothesis-testing"><i class="fa fa-check"></i><b>1.4</b> Hypothesis testing</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="session02.html"><a href="session02.html"><i class="fa fa-check"></i><b>2</b> Forecasting with time-series regression</a>
<ul>
<li class="chapter" data-level="2.1" data-path="session02.html"><a href="session02.html#oracle-inequality"><i class="fa fa-check"></i><b>2.1</b> Oracle inequality</a></li>
<li class="chapter" data-level="2.2" data-path="session02.html"><a href="session02.html#application-forecasting-unemployment"><i class="fa fa-check"></i><b>2.2</b> Application: forecasting unemployment</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="session03.html"><a href="session03.html"><i class="fa fa-check"></i><b>3</b> Large-dimensional methods for forecasting</a>
<ul>
<li class="chapter" data-level="3.1" data-path="session03.html"><a href="session03.html#preprocess-fred-md"><i class="fa fa-check"></i><b>3.1</b> Preprocess FRED-MD</a></li>
<li class="chapter" data-level="3.2" data-path="session03.html"><a href="session03.html#forecasting-algorithms"><i class="fa fa-check"></i><b>3.2</b> Forecasting algorithms</a></li>
<li class="chapter" data-level="3.3" data-path="session03.html"><a href="session03.html#forecast-evaluation"><i class="fa fa-check"></i><b>3.3</b> Forecast evaluation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="session04.html"><a href="session04.html"><i class="fa fa-check"></i><b>4</b> ARMA(1,1) model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="session04.html"><a href="session04.html#mle-for-the-arma11"><i class="fa fa-check"></i><b>4.1</b> MLE for the ARMA(1,1)</a></li>
<li class="chapter" data-level="4.2" data-path="session04.html"><a href="session04.html#exercises"><i class="fa fa-check"></i><b>4.2</b> Exercises</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/aciancetta" target="blank">Alessandro Ciancetta</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Financial Econometrics - Tutorials</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="session03" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Session 3</span> Large-dimensional methods for forecasting<a href="session03.html#session03" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this session we compare the performances of four forecasting methods to predict the monthly change in the U.S. unemployment rate using more than 100 variables from the FRED-MD dataset. In order to deal with the large amount of data, we consider methods based on principal component analysis, penalized likelihood and regression trees.</p>
<div id="preprocess-fred-md" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Preprocess FRED-MD<a href="session03.html#preprocess-fred-md" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The preprocessing of the data is very similar to that of the previous session. The only difference is that we now transform all the series in the dataset using the list of transformation functions of the previous session.</p>
<p>For simplicity, here we remove the columns with missing values. An alternative could be to impute the missing values using some regression technique. However, it is important to notice that in the latter case we should impute the missing values at each step of the forecast evaluation to make sure that no future information is included in the forecasts.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="session03.html#cb58-1" tabindex="-1"></a><span class="do">## load data</span></span>
<span id="cb58-2"><a href="session03.html#cb58-2" tabindex="-1"></a>fredmd <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;../data/current.csv&quot;</span>)</span>
<span id="cb58-3"><a href="session03.html#cb58-3" tabindex="-1"></a>dates  <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(fredmd<span class="sc">$</span>sasdate[<span class="sc">-</span><span class="dv">1</span>],<span class="st">&#39;%m/%d/%Y&#39;</span>)</span>
<span id="cb58-4"><a href="session03.html#cb58-4" tabindex="-1"></a>target_variables <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;UNRATE&quot;</span>, <span class="st">&quot;W875RX1&quot;</span>, <span class="st">&quot;GS10&quot;</span>, <span class="st">&quot;CPIAUCSL&quot;</span>, <span class="st">&quot;WPSFD49207&quot;</span>, </span>
<span id="cb58-5"><a href="session03.html#cb58-5" tabindex="-1"></a>                      <span class="st">&quot;PAYEMS&quot;</span>, <span class="st">&quot;HOUST&quot;</span>, <span class="st">&quot;INDPRO&quot;</span>, <span class="st">&quot;M2SL&quot;</span>, <span class="st">&quot;S.P.500&quot;</span>)</span>
<span id="cb58-6"><a href="session03.html#cb58-6" tabindex="-1"></a></span>
<span id="cb58-7"><a href="session03.html#cb58-7" tabindex="-1"></a><span class="do">## get tcodes</span></span>
<span id="cb58-8"><a href="session03.html#cb58-8" tabindex="-1"></a>tcodes <span class="ot">&lt;-</span> fredmd[<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb58-9"><a href="session03.html#cb58-9" tabindex="-1"></a>d      <span class="ot">&lt;-</span> fredmd[<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>]</span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="session03.html#cb59-1" tabindex="-1"></a><span class="do">## Transform variables</span></span>
<span id="cb59-2"><a href="session03.html#cb59-2" tabindex="-1"></a><span class="co"># transformation functions</span></span>
<span id="cb59-3"><a href="session03.html#cb59-3" tabindex="-1"></a>transform_fredmd <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb59-4"><a href="session03.html#cb59-4" tabindex="-1"></a>  <span class="cf">function</span>(x) x,</span>
<span id="cb59-5"><a href="session03.html#cb59-5" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(x)),</span>
<span id="cb59-6"><a href="session03.html#cb59-6" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">diff</span>(x, <span class="at">differences =</span> <span class="dv">2</span>)),</span>
<span id="cb59-7"><a href="session03.html#cb59-7" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">log</span>(x),</span>
<span id="cb59-8"><a href="session03.html#cb59-8" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(<span class="fu">log</span>(x))),</span>
<span id="cb59-9"><a href="session03.html#cb59-9" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">diff</span>(<span class="fu">log</span>(x), <span class="at">differences =</span> <span class="dv">2</span>)),</span>
<span id="cb59-10"><a href="session03.html#cb59-10" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">diff</span>( x[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(x)]<span class="sc">/</span>x[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(x)<span class="sc">-</span><span class="dv">1</span>)] <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb59-11"><a href="session03.html#cb59-11" tabindex="-1"></a>)</span>
<span id="cb59-12"><a href="session03.html#cb59-12" tabindex="-1"></a></span>
<span id="cb59-13"><a href="session03.html#cb59-13" tabindex="-1"></a><span class="co"># transform series one by one</span></span>
<span id="cb59-14"><a href="session03.html#cb59-14" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(d)) {</span>
<span id="cb59-15"><a href="session03.html#cb59-15" tabindex="-1"></a>  tcode <span class="ot">&lt;-</span> tcodes[[j]]</span>
<span id="cb59-16"><a href="session03.html#cb59-16" tabindex="-1"></a>  d[,j] <span class="ot">&lt;-</span> transform_fredmd[[tcode]](d[,j])</span>
<span id="cb59-17"><a href="session03.html#cb59-17" tabindex="-1"></a>}</span>
<span id="cb59-18"><a href="session03.html#cb59-18" tabindex="-1"></a></span>
<span id="cb59-19"><a href="session03.html#cb59-19" tabindex="-1"></a><span class="do">## Subset and remove columns with NAs</span></span>
<span id="cb59-20"><a href="session03.html#cb59-20" tabindex="-1"></a>d <span class="ot">&lt;-</span> d[dates <span class="sc">&gt;=</span> <span class="st">&#39;1980-01-01&#39;</span>, ]</span>
<span id="cb59-21"><a href="session03.html#cb59-21" tabindex="-1"></a>dates <span class="ot">&lt;-</span> dates[dates <span class="sc">&gt;=</span> <span class="st">&#39;1980-01-01&#39;</span>]</span>
<span id="cb59-22"><a href="session03.html#cb59-22" tabindex="-1"></a>idx_na <span class="ot">&lt;-</span> (<span class="fu">colSums</span>(<span class="fu">is.na</span>(d))<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb59-23"><a href="session03.html#cb59-23" tabindex="-1"></a>d <span class="ot">&lt;-</span> d[, idx_na]</span>
<span id="cb59-24"><a href="session03.html#cb59-24" tabindex="-1"></a><span class="fu">plot.ts</span>(d[,target_variables])</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
</div>
<div id="forecasting-algorithms" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Forecasting algorithms<a href="session03.html#forecasting-algorithms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Below we define the forecasting algorithms that we use in the forecast evaluation.</p>
<p>Notice that at each step of the forecast evaluation we rescale the data so that each variable has mean zero and unit variance. This step is very important for many machine learning algorithms. If the variables have a different magnitude, the optimization procedure involved tend to over-focus on the features with higher magnitude, while we want to exploit the variability of each feature irrespectively of its scale.</p>
<p>Also, we do not explicitly account for outliers in the forecasting algorithms, and we simply discard the Covid period during the evaluation of the results. In this sense, the procedure will tend to benefit those methods that can automatically deal better with the presence of outliers in the data used for estimation.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="session03.html#cb60-1" tabindex="-1"></a><span class="do">## Principal Component Regression (PCR)</span></span>
<span id="cb60-2"><a href="session03.html#cb60-2" tabindex="-1"></a>pcr <span class="ot">&lt;-</span> <span class="cf">function</span>(d, target, n_components, horizon) {</span>
<span id="cb60-3"><a href="session03.html#cb60-3" tabindex="-1"></a>  </span>
<span id="cb60-4"><a href="session03.html#cb60-4" tabindex="-1"></a>  <span class="do">## Scale the data</span></span>
<span id="cb60-5"><a href="session03.html#cb60-5" tabindex="-1"></a>  d_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(d)</span>
<span id="cb60-6"><a href="session03.html#cb60-6" tabindex="-1"></a>  d_mean <span class="ot">&lt;-</span> <span class="fu">attr</span>(d_scaled, <span class="st">&quot;scaled:center&quot;</span>)</span>
<span id="cb60-7"><a href="session03.html#cb60-7" tabindex="-1"></a>  d_sd <span class="ot">&lt;-</span> <span class="fu">attr</span>(d_scaled, <span class="st">&quot;scaled:scale&quot;</span>)</span>
<span id="cb60-8"><a href="session03.html#cb60-8" tabindex="-1"></a>  </span>
<span id="cb60-9"><a href="session03.html#cb60-9" tabindex="-1"></a>  <span class="do">## get the target</span></span>
<span id="cb60-10"><a href="session03.html#cb60-10" tabindex="-1"></a>  target_idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(d) <span class="sc">==</span> target)</span>
<span id="cb60-11"><a href="session03.html#cb60-11" tabindex="-1"></a>  y <span class="ot">&lt;-</span> d_scaled[,target_idx]    </span>
<span id="cb60-12"><a href="session03.html#cb60-12" tabindex="-1"></a>  <span class="do">## get the principal components of the other variables</span></span>
<span id="cb60-13"><a href="session03.html#cb60-13" tabindex="-1"></a>  x <span class="ot">&lt;-</span> d_scaled[,<span class="sc">-</span>target_idx]</span>
<span id="cb60-14"><a href="session03.html#cb60-14" tabindex="-1"></a>  eigen_list <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(x, <span class="at">center=</span><span class="cn">FALSE</span>)</span>
<span id="cb60-15"><a href="session03.html#cb60-15" tabindex="-1"></a>  f <span class="ot">&lt;-</span> eigen_list<span class="sc">$</span>x[,<span class="dv">1</span><span class="sc">:</span>n_components] </span>
<span id="cb60-16"><a href="session03.html#cb60-16" tabindex="-1"></a>  </span>
<span id="cb60-17"><a href="session03.html#cb60-17" tabindex="-1"></a>  <span class="do">## define the dataframes </span></span>
<span id="cb60-18"><a href="session03.html#cb60-18" tabindex="-1"></a>  t_max <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb60-19"><a href="session03.html#cb60-19" tabindex="-1"></a>  d_pcr <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(</span>
<span id="cb60-20"><a href="session03.html#cb60-20" tabindex="-1"></a>    <span class="at">y     =</span> y[(horizon<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>t_max], </span>
<span id="cb60-21"><a href="session03.html#cb60-21" tabindex="-1"></a>    <span class="at">y_lag =</span>  y[<span class="dv">1</span><span class="sc">:</span>(t_max<span class="sc">-</span>horizon)],  </span>
<span id="cb60-22"><a href="session03.html#cb60-22" tabindex="-1"></a>    f[<span class="dv">1</span><span class="sc">:</span>(t_max<span class="sc">-</span>horizon),])</span>
<span id="cb60-23"><a href="session03.html#cb60-23" tabindex="-1"></a>  )</span>
<span id="cb60-24"><a href="session03.html#cb60-24" tabindex="-1"></a>  </span>
<span id="cb60-25"><a href="session03.html#cb60-25" tabindex="-1"></a>  <span class="do">## fit</span></span>
<span id="cb60-26"><a href="session03.html#cb60-26" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> ., <span class="at">data =</span> d_pcr)</span>
<span id="cb60-27"><a href="session03.html#cb60-27" tabindex="-1"></a>  </span>
<span id="cb60-28"><a href="session03.html#cb60-28" tabindex="-1"></a>  <span class="do">## forecast</span></span>
<span id="cb60-29"><a href="session03.html#cb60-29" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> d_pcr[<span class="fu">nrow</span>(d_pcr), ])</span>
<span id="cb60-30"><a href="session03.html#cb60-30" tabindex="-1"></a>  </span>
<span id="cb60-31"><a href="session03.html#cb60-31" tabindex="-1"></a>  <span class="do">## output</span></span>
<span id="cb60-32"><a href="session03.html#cb60-32" tabindex="-1"></a>  pred<span class="sc">*</span>d_sd[target] <span class="sc">+</span> d_mean[target]</span>
<span id="cb60-33"><a href="session03.html#cb60-33" tabindex="-1"></a>}</span>
<span id="cb60-34"><a href="session03.html#cb60-34" tabindex="-1"></a></span>
<span id="cb60-35"><a href="session03.html#cb60-35" tabindex="-1"></a><span class="co"># pcr(d, &quot;INDPRO&quot;, 4, 1)</span></span></code></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="session03.html#cb61-1" tabindex="-1"></a><span class="do">## Penalized regression: LASSO (alpha = 1) and ridge (alpha = 0)</span></span>
<span id="cb61-2"><a href="session03.html#cb61-2" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span></code></pre></div>
<pre><code>## Caricamento del pacchetto richiesto: Matrix</code></pre>
<pre><code>## Loaded glmnet 4.1-4</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="session03.html#cb64-1" tabindex="-1"></a>penalized_reg <span class="ot">&lt;-</span> <span class="cf">function</span>(d, target, horizon, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">nlambda =</span> <span class="dv">100</span>) {</span>
<span id="cb64-2"><a href="session03.html#cb64-2" tabindex="-1"></a>  </span>
<span id="cb64-3"><a href="session03.html#cb64-3" tabindex="-1"></a>  <span class="do">## Scale the data</span></span>
<span id="cb64-4"><a href="session03.html#cb64-4" tabindex="-1"></a>  d_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(d)</span>
<span id="cb64-5"><a href="session03.html#cb64-5" tabindex="-1"></a>  d_mean <span class="ot">&lt;-</span> <span class="fu">attr</span>(d_scaled, <span class="st">&quot;scaled:center&quot;</span>)</span>
<span id="cb64-6"><a href="session03.html#cb64-6" tabindex="-1"></a>  d_sd <span class="ot">&lt;-</span> <span class="fu">attr</span>(d_scaled, <span class="st">&quot;scaled:scale&quot;</span>)</span>
<span id="cb64-7"><a href="session03.html#cb64-7" tabindex="-1"></a>  </span>
<span id="cb64-8"><a href="session03.html#cb64-8" tabindex="-1"></a>  <span class="do">## get the target and predictors</span></span>
<span id="cb64-9"><a href="session03.html#cb64-9" tabindex="-1"></a>  t_max <span class="ot">&lt;-</span> <span class="fu">nrow</span>(d)</span>
<span id="cb64-10"><a href="session03.html#cb64-10" tabindex="-1"></a>  y <span class="ot">&lt;-</span> d_scaled[(horizon<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>t_max, target]   </span>
<span id="cb64-11"><a href="session03.html#cb64-11" tabindex="-1"></a>  x <span class="ot">&lt;-</span> d_scaled[<span class="dv">1</span><span class="sc">:</span>(t_max<span class="sc">-</span>horizon), ] <span class="co"># include also lagged target variable</span></span>
<span id="cb64-12"><a href="session03.html#cb64-12" tabindex="-1"></a>  </span>
<span id="cb64-13"><a href="session03.html#cb64-13" tabindex="-1"></a>  <span class="do">## fit the model</span></span>
<span id="cb64-14"><a href="session03.html#cb64-14" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>, </span>
<span id="cb64-15"><a href="session03.html#cb64-15" tabindex="-1"></a>                  <span class="at">alpha =</span> alpha, <span class="at">nlambda =</span> nlambda)</span>
<span id="cb64-16"><a href="session03.html#cb64-16" tabindex="-1"></a>  </span>
<span id="cb64-17"><a href="session03.html#cb64-17" tabindex="-1"></a>  <span class="do">## forecast</span></span>
<span id="cb64-18"><a href="session03.html#cb64-18" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newx =</span> x[<span class="fu">nrow</span>(x),])</span>
<span id="cb64-19"><a href="session03.html#cb64-19" tabindex="-1"></a>  </span>
<span id="cb64-20"><a href="session03.html#cb64-20" tabindex="-1"></a>  <span class="do">## Output</span></span>
<span id="cb64-21"><a href="session03.html#cb64-21" tabindex="-1"></a>  pred<span class="sc">*</span>d_sd[target] <span class="sc">+</span> d_mean[target]</span>
<span id="cb64-22"><a href="session03.html#cb64-22" tabindex="-1"></a>}</span>
<span id="cb64-23"><a href="session03.html#cb64-23" tabindex="-1"></a></span>
<span id="cb64-24"><a href="session03.html#cb64-24" tabindex="-1"></a><span class="co"># penalized_reg(d, &quot;INDPRO&quot;, 1, 1) # one value for each lambda</span></span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="session03.html#cb65-1" tabindex="-1"></a><span class="do">## Random forest</span></span>
<span id="cb65-2"><a href="session03.html#cb65-2" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb65-3"><a href="session03.html#cb65-3" tabindex="-1"></a>forest <span class="ot">&lt;-</span> <span class="cf">function</span>(d, target, horizon, <span class="at">seed =</span> <span class="dv">1</span>, <span class="at">ntree =</span> <span class="dv">100</span>) {</span>
<span id="cb65-4"><a href="session03.html#cb65-4" tabindex="-1"></a>  </span>
<span id="cb65-5"><a href="session03.html#cb65-5" tabindex="-1"></a>  <span class="do">## Scale the data</span></span>
<span id="cb65-6"><a href="session03.html#cb65-6" tabindex="-1"></a>  d_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(d)</span>
<span id="cb65-7"><a href="session03.html#cb65-7" tabindex="-1"></a>  d_mean <span class="ot">&lt;-</span> <span class="fu">attr</span>(d_scaled, <span class="st">&quot;scaled:center&quot;</span>)</span>
<span id="cb65-8"><a href="session03.html#cb65-8" tabindex="-1"></a>  d_sd <span class="ot">&lt;-</span> <span class="fu">attr</span>(d_scaled, <span class="st">&quot;scaled:scale&quot;</span>)</span>
<span id="cb65-9"><a href="session03.html#cb65-9" tabindex="-1"></a>  </span>
<span id="cb65-10"><a href="session03.html#cb65-10" tabindex="-1"></a>  <span class="do">## get the target and predictors</span></span>
<span id="cb65-11"><a href="session03.html#cb65-11" tabindex="-1"></a>  t_max <span class="ot">&lt;-</span> <span class="fu">nrow</span>(d)</span>
<span id="cb65-12"><a href="session03.html#cb65-12" tabindex="-1"></a>  y <span class="ot">&lt;-</span> d_scaled[(horizon<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>t_max, target]   </span>
<span id="cb65-13"><a href="session03.html#cb65-13" tabindex="-1"></a>  x <span class="ot">&lt;-</span> d_scaled[<span class="dv">1</span><span class="sc">:</span>(t_max<span class="sc">-</span>horizon), ] <span class="co"># include also lagged target variable</span></span>
<span id="cb65-14"><a href="session03.html#cb65-14" tabindex="-1"></a>  </span>
<span id="cb65-15"><a href="session03.html#cb65-15" tabindex="-1"></a>  <span class="do">## fit the model</span></span>
<span id="cb65-16"><a href="session03.html#cb65-16" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb65-17"><a href="session03.html#cb65-17" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">ntree =</span> ntree)</span>
<span id="cb65-18"><a href="session03.html#cb65-18" tabindex="-1"></a>  </span>
<span id="cb65-19"><a href="session03.html#cb65-19" tabindex="-1"></a>  <span class="do">## forecast</span></span>
<span id="cb65-20"><a href="session03.html#cb65-20" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> x[<span class="fu">nrow</span>(x),])</span>
<span id="cb65-21"><a href="session03.html#cb65-21" tabindex="-1"></a></span>
<span id="cb65-22"><a href="session03.html#cb65-22" tabindex="-1"></a>  <span class="do">## Output</span></span>
<span id="cb65-23"><a href="session03.html#cb65-23" tabindex="-1"></a>  pred<span class="sc">*</span>d_sd[target] <span class="sc">+</span> d_mean[target]</span>
<span id="cb65-24"><a href="session03.html#cb65-24" tabindex="-1"></a>}</span>
<span id="cb65-25"><a href="session03.html#cb65-25" tabindex="-1"></a></span>
<span id="cb65-26"><a href="session03.html#cb65-26" tabindex="-1"></a><span class="co"># forest(d, &quot;INDPRO&quot;, 1)</span></span></code></pre></div>
</div>
<div id="forecast-evaluation" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Forecast evaluation<a href="session03.html#forecast-evaluation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can now run the algorithms and compare their forecasting performances over the 2002-2020 period.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="session03.html#cb66-1" tabindex="-1"></a><span class="do">## Initialize objects</span></span>
<span id="cb66-2"><a href="session03.html#cb66-2" tabindex="-1"></a>forecast_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb66-3"><a href="session03.html#cb66-3" tabindex="-1"></a>  <span class="at">pcr =</span> <span class="fu">c</span>(),</span>
<span id="cb66-4"><a href="session03.html#cb66-4" tabindex="-1"></a>  <span class="at">ridge =</span> <span class="fu">list</span>(),</span>
<span id="cb66-5"><a href="session03.html#cb66-5" tabindex="-1"></a>  <span class="at">lasso =</span> <span class="fu">list</span>(),</span>
<span id="cb66-6"><a href="session03.html#cb66-6" tabindex="-1"></a>  <span class="at">forest =</span> <span class="fu">c</span>()</span>
<span id="cb66-7"><a href="session03.html#cb66-7" tabindex="-1"></a>)</span>
<span id="cb66-8"><a href="session03.html#cb66-8" tabindex="-1"></a><span class="co"># choose target variable and forecast horizon</span></span>
<span id="cb66-9"><a href="session03.html#cb66-9" tabindex="-1"></a>target <span class="ot">&lt;-</span> <span class="st">&quot;UNRATE&quot;</span></span>
<span id="cb66-10"><a href="session03.html#cb66-10" tabindex="-1"></a>horizon <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb66-11"><a href="session03.html#cb66-11" tabindex="-1"></a></span>
<span id="cb66-12"><a href="session03.html#cb66-12" tabindex="-1"></a><span class="co"># pick the initial window for training and choose the test period</span></span>
<span id="cb66-13"><a href="session03.html#cb66-13" tabindex="-1"></a>initial_window <span class="ot">&lt;-</span> <span class="fu">sum</span>(dates <span class="sc">&lt;</span> <span class="st">&quot;2002-01-01&quot;</span>)</span>
<span id="cb66-14"><a href="session03.html#cb66-14" tabindex="-1"></a>idx_eval <span class="ot">&lt;-</span> <span class="fu">which</span>(((dates <span class="sc">&lt;</span> <span class="st">&quot;2020-02-01&quot;</span>)) <span class="sc">&amp;</span> </span>
<span id="cb66-15"><a href="session03.html#cb66-15" tabindex="-1"></a>                    dates <span class="sc">&gt;=</span> <span class="st">&quot;2002-01-01&quot;</span>) <span class="sc">-</span> initial_window</span>
<span id="cb66-16"><a href="session03.html#cb66-16" tabindex="-1"></a></span>
<span id="cb66-17"><a href="session03.html#cb66-17" tabindex="-1"></a><span class="co"># total steps of the forecast evaluation and selection of the test data</span></span>
<span id="cb66-18"><a href="session03.html#cb66-18" tabindex="-1"></a>n_steps <span class="ot">&lt;-</span> <span class="fu">nrow</span>(d) <span class="sc">-</span> initial_window <span class="sc">-</span> horizon <span class="sc">+</span> <span class="dv">1</span> </span>
<span id="cb66-19"><a href="session03.html#cb66-19" tabindex="-1"></a>data_test <span class="ot">&lt;-</span> d[(initial_window<span class="sc">+</span>horizon)<span class="sc">:</span><span class="fu">nrow</span>(d), target]</span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="session03.html#cb67-1" tabindex="-1"></a><span class="do">## expanding window forecast evaluation</span></span>
<span id="cb67-2"><a href="session03.html#cb67-2" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_steps) {</span>
<span id="cb67-3"><a href="session03.html#cb67-3" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\r</span><span class="st">Step&quot;</span>, s, <span class="st">&quot;of&quot;</span>, n_steps)</span>
<span id="cb67-4"><a href="session03.html#cb67-4" tabindex="-1"></a>  data_train <span class="ot">&lt;-</span> d[<span class="dv">1</span><span class="sc">:</span>(initial_window<span class="sc">+</span>s<span class="dv">-1</span>),]</span>
<span id="cb67-5"><a href="session03.html#cb67-5" tabindex="-1"></a>  </span>
<span id="cb67-6"><a href="session03.html#cb67-6" tabindex="-1"></a>  forecast_list<span class="sc">$</span>pcr[s] <span class="ot">&lt;-</span> <span class="fu">pcr</span>(data_train, target, </span>
<span id="cb67-7"><a href="session03.html#cb67-7" tabindex="-1"></a>                              <span class="at">n_components =</span> <span class="dv">4</span>, <span class="at">horizon =</span> horizon)</span>
<span id="cb67-8"><a href="session03.html#cb67-8" tabindex="-1"></a>  forecast_list<span class="sc">$</span>ridge[[s]] <span class="ot">&lt;-</span> <span class="fu">penalized_reg</span>(data_train, target, </span>
<span id="cb67-9"><a href="session03.html#cb67-9" tabindex="-1"></a>                                            <span class="at">horizon =</span> horizon, <span class="at">alpha =</span> <span class="dv">0</span>) </span>
<span id="cb67-10"><a href="session03.html#cb67-10" tabindex="-1"></a>  forecast_list<span class="sc">$</span>lasso[[s]] <span class="ot">&lt;-</span> <span class="fu">penalized_reg</span>(data_train, target, </span>
<span id="cb67-11"><a href="session03.html#cb67-11" tabindex="-1"></a>                                            <span class="at">horizon =</span> horizon, <span class="at">alpha =</span> <span class="dv">1</span>) </span>
<span id="cb67-12"><a href="session03.html#cb67-12" tabindex="-1"></a>  forecast_list<span class="sc">$</span>forest[s] <span class="ot">&lt;-</span> <span class="fu">forest</span>(data_train, target,</span>
<span id="cb67-13"><a href="session03.html#cb67-13" tabindex="-1"></a>                                    <span class="at">horizon =</span> horizon,</span>
<span id="cb67-14"><a href="session03.html#cb67-14" tabindex="-1"></a>                                    <span class="at">ntree =</span> <span class="dv">100</span>)</span>
<span id="cb67-15"><a href="session03.html#cb67-15" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Remark</strong>: here we just pick one value of <span class="math inline">\(\lambda\)</span> among the many
that we used for estimating ridge and LASSO regressions.
A more rigourous approach would consist in using either information
criteria or cross validation to pick the optimal <span class="math inline">\(\lambda\)</span>. We omit this part for simplicity of exposition.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="session03.html#cb68-1" tabindex="-1"></a><span class="do">## Comppute the RMSE of the predictions</span></span>
<span id="cb68-2"><a href="session03.html#cb68-2" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="cf">function</span>(y, f) {<span class="fu">sqrt</span>(<span class="fu">mean</span>((y<span class="sc">-</span>f)<span class="sc">^</span><span class="dv">2</span>))}</span>
<span id="cb68-3"><a href="session03.html#cb68-3" tabindex="-1"></a></span>
<span id="cb68-4"><a href="session03.html#cb68-4" tabindex="-1"></a>pred_ridge <span class="ot">&lt;-</span> <span class="fu">sapply</span>(forecast_list<span class="sc">$</span>ridge, <span class="cf">function</span>(x) x[<span class="dv">30</span>])</span>
<span id="cb68-5"><a href="session03.html#cb68-5" tabindex="-1"></a>pred_lasso <span class="ot">&lt;-</span> <span class="fu">sapply</span>(forecast_list<span class="sc">$</span>lasso, <span class="cf">function</span>(x) x[<span class="dv">8</span>])</span>
<span id="cb68-6"><a href="session03.html#cb68-6" tabindex="-1"></a>pred_mean  <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">mean</span>(d[<span class="dv">1</span><span class="sc">:</span>initial_window, target]), n_steps)</span>
<span id="cb68-7"><a href="session03.html#cb68-7" tabindex="-1"></a></span>
<span id="cb68-8"><a href="session03.html#cb68-8" tabindex="-1"></a><span class="fu">rbind</span>(</span>
<span id="cb68-9"><a href="session03.html#cb68-9" tabindex="-1"></a>  <span class="at">mean   =</span> <span class="fu">rmse</span>(data_test[idx_eval], pred_mean[idx_eval]),</span>
<span id="cb68-10"><a href="session03.html#cb68-10" tabindex="-1"></a>  <span class="at">pcr    =</span> <span class="fu">rmse</span>(data_test[idx_eval], forecast_list<span class="sc">$</span>pcr[idx_eval]),</span>
<span id="cb68-11"><a href="session03.html#cb68-11" tabindex="-1"></a>  <span class="at">forest =</span> <span class="fu">rmse</span>(data_test[idx_eval], forecast_list<span class="sc">$</span>forest[idx_eval]),</span>
<span id="cb68-12"><a href="session03.html#cb68-12" tabindex="-1"></a>  <span class="at">ridge  =</span> <span class="fu">rmse</span>(data_test[idx_eval], pred_ridge[idx_eval]),</span>
<span id="cb68-13"><a href="session03.html#cb68-13" tabindex="-1"></a>  <span class="at">lasso  =</span> <span class="fu">rmse</span>(data_test[idx_eval], pred_lasso[idx_eval])</span>
<span id="cb68-14"><a href="session03.html#cb68-14" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##             [,1]
## mean   0.1600012
## pcr    0.1513172
## forest 0.1676554
## ridge  0.1475805
## lasso  0.1416051</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="session03.html#cb70-1" tabindex="-1"></a><span class="do">## Plot the forecasted values</span></span>
<span id="cb70-2"><a href="session03.html#cb70-2" tabindex="-1"></a>ground_truth   <span class="ot">&lt;-</span> <span class="fu">ts</span>(data_test[idx_eval], <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2002</span>, <span class="dv">1</span>), <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb70-3"><a href="session03.html#cb70-3" tabindex="-1"></a>pred_benchmark <span class="ot">&lt;-</span> <span class="fu">ts</span>(pred_mean[idx_eval], <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2002</span>, <span class="dv">1</span>), <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb70-4"><a href="session03.html#cb70-4" tabindex="-1"></a>pred_pcr       <span class="ot">&lt;-</span> <span class="fu">ts</span>(forecast_list<span class="sc">$</span>pcr[idx_eval], <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2002</span>, <span class="dv">1</span>), <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb70-5"><a href="session03.html#cb70-5" tabindex="-1"></a>pred_lasso     <span class="ot">&lt;-</span> <span class="fu">ts</span>(pred_lasso[idx_eval], <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2002</span>, <span class="dv">1</span>), <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb70-6"><a href="session03.html#cb70-6" tabindex="-1"></a><span class="fu">plot.ts</span>(ground_truth, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb70-7"><a href="session03.html#cb70-7" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Forecasts VS. ground truth&quot;</span>, </span>
<span id="cb70-8"><a href="session03.html#cb70-8" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;UNRATE change&quot;</span>)</span>
<span id="cb70-9"><a href="session03.html#cb70-9" tabindex="-1"></a><span class="fu">lines</span>(pred_benchmark, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;darkgrey&quot;</span>)</span>
<span id="cb70-10"><a href="session03.html#cb70-10" tabindex="-1"></a><span class="fu">lines</span>(pred_pcr, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">col =</span> <span class="st">&quot;darkred&quot;</span>, <span class="at">pch =</span> <span class="dv">18</span>)</span>
<span id="cb70-11"><a href="session03.html#cb70-11" tabindex="-1"></a><span class="fu">lines</span>(pred_lasso, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">col =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb70-12"><a href="session03.html#cb70-12" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;PCR&quot;</span>, <span class="st">&quot;LASSO&quot;</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;darkred&quot;</span>, <span class="st">&quot;steelblue&quot;</span>), </span>
<span id="cb70-13"><a href="session03.html#cb70-13" tabindex="-1"></a>       <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">19</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="session03.html#cb71-1" tabindex="-1"></a><span class="do">## Diebold-Mariano test</span></span>
<span id="cb71-2"><a href="session03.html#cb71-2" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb71-3"><a href="session03.html#cb71-3" tabindex="-1"></a>err_benchmark <span class="ot">&lt;-</span> data_test[idx_eval] <span class="sc">-</span> pred_mean[idx_eval]</span>
<span id="cb71-4"><a href="session03.html#cb71-4" tabindex="-1"></a>err_lasso <span class="ot">&lt;-</span> data_test[idx_eval] <span class="sc">-</span> pred_lasso[idx_eval]</span>
<span id="cb71-5"><a href="session03.html#cb71-5" tabindex="-1"></a>err_pcr <span class="ot">&lt;-</span> data_test[idx_eval] <span class="sc">-</span> forecast_list<span class="sc">$</span>pcr[idx_eval]</span>
<span id="cb71-6"><a href="session03.html#cb71-6" tabindex="-1"></a></span>
<span id="cb71-7"><a href="session03.html#cb71-7" tabindex="-1"></a><span class="co"># LASSO</span></span>
<span id="cb71-8"><a href="session03.html#cb71-8" tabindex="-1"></a><span class="fu">dm.test</span>(err_benchmark, err_lasso, <span class="at">alternative =</span> <span class="st">&quot;greater&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Diebold-Mariano Test
## 
## data:  err_benchmarkerr_lasso
## DM = 3.9017, Forecast horizon = 1, Loss function power = 2, p-value =
## 6.381e-05
## alternative hypothesis: greater</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="session03.html#cb73-1" tabindex="-1"></a><span class="co"># PCR</span></span>
<span id="cb73-2"><a href="session03.html#cb73-2" tabindex="-1"></a><span class="fu">dm.test</span>(err_benchmark, err_pcr, <span class="at">alternative =</span> <span class="st">&quot;greater&quot;</span>) </span></code></pre></div>
<pre><code>## 
##  Diebold-Mariano Test
## 
## data:  err_benchmarkerr_pcr
## DM = 1.0484, Forecast horizon = 1, Loss function power = 2, p-value =
## 0.1478
## alternative hypothesis: greater</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="session03.html#cb75-1" tabindex="-1"></a><span class="do">## plot the cumulated squared errors over time</span></span>
<span id="cb75-2"><a href="session03.html#cb75-2" tabindex="-1"></a><span class="co"># compute the (normalized) cumulated squared errors and convert to ts object</span></span>
<span id="cb75-3"><a href="session03.html#cb75-3" tabindex="-1"></a>err2_benchmark <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">cumsum</span>((err_benchmark)<span class="sc">^</span><span class="dv">2</span>), <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2002</span>, <span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb75-4"><a href="session03.html#cb75-4" tabindex="-1"></a>err2_pcr       <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">cumsum</span>((err_pcr)<span class="sc">^</span><span class="dv">2</span>), <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2002</span>, <span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb75-5"><a href="session03.html#cb75-5" tabindex="-1"></a>err2_lasso     <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">cumsum</span>((err_lasso)<span class="sc">^</span><span class="dv">2</span>), <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">2002</span>, <span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb75-6"><a href="session03.html#cb75-6" tabindex="-1"></a>err2_constant  <span class="ot">&lt;-</span> <span class="fu">sum</span>(err_benchmark<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb75-7"><a href="session03.html#cb75-7" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb75-8"><a href="session03.html#cb75-8" tabindex="-1"></a><span class="fu">plot.ts</span>(err2_benchmark<span class="sc">/</span>err2_constant, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb75-9"><a href="session03.html#cb75-9" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Cumulated squared errors&quot;</span>,</span>
<span id="cb75-10"><a href="session03.html#cb75-10" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Forecast errors over time&quot;</span>,</span>
<span id="cb75-11"><a href="session03.html#cb75-11" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb75-12"><a href="session03.html#cb75-12" tabindex="-1"></a><span class="fu">lines</span>(err2_pcr<span class="sc">/</span>err2_constant, <span class="at">col =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb75-13"><a href="session03.html#cb75-13" tabindex="-1"></a><span class="fu">lines</span>(err2_lasso<span class="sc">/</span>err2_constant, <span class="at">col =</span> <span class="st">&quot;darkred&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb75-14"><a href="session03.html#cb75-14" tabindex="-1"></a><span class="fu">rect</span>(<span class="dv">2008</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="fl">2009.5</span>,<span class="fl">1.5</span>,<span class="at">col =</span> <span class="fu">rgb</span>(<span class="fl">0.6</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb75-15"><a href="session03.html#cb75-15" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;Sample mean&quot;</span>, <span class="st">&quot;PCR&quot;</span>, <span class="st">&quot;LASSO&quot;</span>), </span>
<span id="cb75-16"><a href="session03.html#cb75-16" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;steelblue&quot;</span>, <span class="st">&quot;darkred&quot;</span>), <span class="at">lwd=</span><span class="dv">6</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<!-- # Parts -->
<!-- You can add parts to organize one or more book chapters together. Parts can be inserted at the top of an .Rmd file, before the first-level chapter heading in that same file.  -->
<!-- Add a numbered part: `# (PART) Act one {-}` (followed by `# A chapter`) -->
<!-- Add an unnumbered part: `# (PART\*) Act one {-}` (followed by `# A chapter`) -->
<!-- Add an appendix as a special kind of un-numbered part: `# (APPENDIX) Other stuff {-}` (followed by `# A chapter`). Chapters in an appendix are prepended with letters instead of numbers. -->

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="session02.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="session04.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/aciancetta/finmetrics/edit/BRANCH/03-session03.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
